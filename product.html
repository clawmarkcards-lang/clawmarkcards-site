<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Claw Mark Cards — Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --bg:#0d0d0d; --text:#f2f2f2; --muted:#bbbbbb; --orange:#ff6a00; --blue:#00c8ff; --gold:#ffcc00; --card:#151515; --edge:#252525; }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);margin:0}
    header{background:var(--orange);padding:20px;text-align:center;border-bottom:3px solid #007bff}
    header h1{margin:0;font-size:2.2em;color:#fff}
    nav a{margin:0 15px;color:#fff;text-decoration:none;font-weight:bold}
    nav a:hover{color:#00c8ff}
    footer{background:#1e1e1e;text-align:center;padding:15px;font-size:.9em;color:#aaa;margin-top:40px}
    .container{max-width:1200px;margin:22px auto;padding:0 18px}
    .panel{background:var(--card);border:1px solid var(--edge);border-radius:14px;padding:14px;box-shadow:0 0 16px rgba(0,0,0,.35)}

    .layout{display:grid;grid-template-columns:520px 1fr;gap:18px}
    @media (max-width:980px){.layout{grid-template-columns:1fr}}

    /* Gallery */
    .gallery{display:flex;flex-direction:column;gap:10px}
    .hero{width:100%;aspect-ratio:1/1;background:#0f0f0f;border-radius:12px;display:flex;align-items:center;justify-content:center}
    .hero img{max-width:100%;max-height:100%;object-fit:contain;border-radius:12px}
    .thumbs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
    .thumbs img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#0f0f0f;border-radius:8px;border:1px solid #2a2a2a;cursor:pointer}
    .thumbs img.active{outline:2px solid var(--blue)}

    /* Info */
    h2.title{margin:2px 0 8px}
    .price{font-weight:800;font-size:1.4em}
    .price .old{color:#bbb;text-decoration:line-through;margin-right:6px;font-weight:600}
    .muted{color:#bbbbbb}
    .kv{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .kv .k{border:1px solid #333;background:#101010;color:#ddd;border-radius:999px;padding:4px 10px;font-size:.92em}
    .badges{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
    .b{border:1px solid #333;background:#101010;color:#ddd;border-radius:999px;padding:2px 8px;font-size:.85em}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{display:inline-block;background:var(--blue);color:#000;padding:10px 16px;border-radius:10px;font-weight:800;text-decoration:none;cursor:pointer;transition:filter .15s}
    .btn:hover{filter:brightness(1.12)}
    .btn-ghost{background:transparent;color:#f2f2f2;border:1px solid #333}
    .warn{color:#ff6b6b;font-weight:700}

    .desc{margin-top:16px;line-height:1.6}
    .back{display:inline-block;margin-bottom:12px;color:var(--blue);text-decoration:none}

    /* Offer modal */
    #offerModal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:10000}
    #offerCard{background:#151515;border:1px solid #333;border-radius:12px;padding:16px;max-width:420px;width:92%}
    #offerCard h3{margin:0 0 8px}
    #offerCard input{width:100%;background:#0f0f0f;color:#fff;border:1px solid #333;border-radius:8px;padding:10px}
  </style>
<!-- Claw Mark Cards header fonts & styles -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rock+Salt&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  .cmc-header--orange{background:#ff6a00;color:#fff;border-bottom:none}
  .cmc-header{position:sticky;top:0;z-index:50;text-align:center;padding:16px 16px 10px 16px}
  .cmc-header .brand{line-height:1}
  .cmc-header .site-title{font-family:"Rock Salt", system-ui, sans-serif;font-size:36px;margin:0;color:#fff}
  .cmc-header .site-motto{font-family:"Rock Salt", system-ui, sans-serif;font-size:16px;margin:6px 0 14px 0;color:#ffe6d5}
  @media (min-width:768px){
    .cmc-header .site-title{font-size:44px}
    .cmc-header .site-motto{font-size:18px}
  }
  .cmc-nav{display:flex;gap:28px;padding:10px 16px 14px 16px;align-items:center;justify-content:center;flex-wrap:wrap;font-family:"Inter",system-ui,sans-serif;font-weight:600}
  .cmc-nav a{text-decoration:none;color:#fff;opacity:.95}
  .cmc-nav a:hover{text-decoration:underline;opacity:1}
</style>

</head>
<body>
<header class="cmc-header cmc-header--orange">
  <div class="brand">
    <h1 class="site-title">Claw Mark Cards</h1>
    <p class="site-motto">Every Rip Leaves Its Mark</p>
  </div>
  <nav class="cmc-nav">
    <a href="/index.html">Home</a>
    <a href="/shop.html">Shop</a>
    <a href="/about.html">About Us</a>
    <a href="/tiers.html">The Marked Tiers</a>
    <a href="/rewards.html">Rewards</a>
    <a href="/social.html">Social Media</a>
    <a href="/login.html">Login</a>
    <a href="/signup.html">Signup</a>
    <a href="/cart.html">Cart</a>
      <a href="/sportscardsplusmb.html">SportsCardsPlusMB</a>
  </nav>
</header>



  <main class="container">
    <a class="back" href="shop.html">← Back to Shop</a>

    <section class="panel layout" id="productWrap" style="display:none;">
      <div class="gallery">
        <div class="hero" id="hero"><img id="heroImg" src="placeholder.png" alt=""></div>
        <div class="thumbs" id="thumbs"></div>
      </div>

      <div>
        <h2 class="title" id="title">Loading…</h2>
        <div class="price" id="price"></div>
        <div class="kv" id="kv"></div>
        <div class="badges" id="badges"></div>
        <div class="actions">
          <button id="addBtn" class="btn">Add to Cart</button>
          <button id="watchBtn" class="btn-ghost">Watch</button>
          <button id="offerBtn" class="btn-ghost">Make Offer</button>
          <span id="qtyNote" class="muted"></span>
        </div>
        <div class="desc" id="desc"></div>
      </div>
    </section>

    <section class="panel" id="empty" style="display:none;">
      <p class="warn">This item is not available.</p>
      <p class="muted">It may be archived or not found.</p>
    </section>
  </main>

  <!-- Offer Modal -->
  <div id="offerModal">
    <div id="offerCard">
      <h3>Make an Offer</h3>
      <div class="muted" id="offerItem"></div>
      <div style="margin-top:10px;">
        <input id="offerAmount" type="number" step="0.01" min="0" placeholder="Your offer (USD)">
      </div>
      <div class="actions" style="justify-content:flex-end;margin-top:12px;">
        <button id="offerCancel" class="btn-ghost">Cancel</button>
        <button id="offerSubmit" class="btn">Submit</button>
      </div>
    </div>
  </div>

  <footer><p>© 2025 Claw Mark Cards • Every Rip Leaves Its Mark</p></footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
  (function(){
    // --- Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyCM5La0C7dKpWgQUpAxVQguDcEV1D4Vmms",
      authDomain: "clawmark-login.firebaseapp.com",
      projectId: "clawmark-login",
      storageBucket: "clawmark-login.firebasestorage.app",
      messagingSenderId: "334338665183",
      appId: "1:334338665183:web:eb179b820393234c74576a",
      measurementId: "G-JE64ZQ56T5"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // --- DOM ---
    const wrap = document.getElementById('productWrap');
    const empty = document.getElementById('empty');
    const heroImg = document.getElementById('heroImg');
    const thumbs = document.getElementById('thumbs');
    const titleEl = document.getElementById('title');
    const priceEl = document.getElementById('price');
    const kvEl = document.getElementById('kv');
    const badgesEl = document.getElementById('badges');
    const descEl = document.getElementById('desc');
    const addBtn = document.getElementById('addBtn');
    const watchBtn = document.getElementById('watchBtn');
    const offerBtn = document.getElementById('offerBtn');
    const qtyNote = document.getElementById('qtyNote');

    // Offer modal
    const offerModal = document.getElementById('offerModal');
    const offerItem = document.getElementById('offerItem');
    const offerAmount = document.getElementById('offerAmount');
    const offerCancel = document.getElementById('offerCancel');
    const offerSubmit = document.getElementById('offerSubmit');

    // --- Helpers ---
    function qparam(name){ return new URLSearchParams(location.search).get(name); }
    function fmt(n){ return '$' + (Number(n||0)).toFixed(2); }
    function setVisible(el, on){ el.style.display = on ? '' : 'none'; }
    function renderThumbs(urls){
      thumbs.innerHTML = (urls||[]).map((u,i)=>`<img data-i="${i}" src="${u}" alt="">`).join('');
      [...thumbs.querySelectorAll('img')].forEach((img,i)=>{
        if(i===0) img.classList.add('active');
        img.addEventListener('click', ()=> {
          heroImg.src = urls[i] || 'placeholder.png';
          thumbs.querySelectorAll('img').forEach(t=>t.classList.remove('active'));
          img.classList.add('active');
        });
      });
    }
    function loadCart(){
      try{ return JSON.parse(localStorage.getItem('cmc_cart')||'[]'); }catch(_){ return []; }
    }
    function saveCart(cart){
      localStorage.setItem('cmc_cart', JSON.stringify(cart));
      alert('Added to cart.');
    }
    function requireLogin(){
      const u = auth.currentUser;
      if(!u){ alert('Please log in first.'); location.href='login.html'; return null; }
      return u;
    }

    let docRef = null;      // reference to the document we loaded
    let data = null;        // product data (active)
    let primaryImg = 'placeholder.png';

    // --- Fetch product ---
    async function fetchProduct() {
      const id = qparam('id');
      const sku = qparam('sku');

      try {
        if (id) {
          docRef = db.collection('products').doc(id);
          const snap = await docRef.get();
          data = snap.exists ? snap.data() : null;
        } else if (sku) {
          const snap = await db.collection('products').where('sku','==',sku).limit(1).get();
          if (!snap.empty) { docRef = snap.docs[0].ref; data = snap.docs[0].data(); }
        }

        if (!data || data.status !== 'active') {
          setVisible(wrap, false); setVisible(empty, true);
          return;
        }

        // Render
        const imgs = (data.images && data.images.length) ? data.images : ['placeholder.png'];
        primaryImg = imgs[0] || 'placeholder.png';
        heroImg.src = primaryImg; heroImg.onerror = () => (heroImg.src='placeholder.png');
        renderThumbs(imgs);
        titleEl.textContent = data.title || 'Untitled';
        priceEl.innerHTML = `${Number(data.compareAtPrice||0) > Number(data.price||0) ? `<span class="old">${fmt(data.compareAtPrice)}</span>` : ''}<span>${fmt(data.price||0)}</span>`;
        qtyNote.textContent = Number.isFinite(data.quantity) ? (data.quantity>1 ? `${data.quantity} available` : `Only 1 available`) : '';

        const kv = [];
        if (data.brand) kv.push(`Brand: ${data.brand}`);
        if (data.sport) kv.push(`Sport: ${data.sport}`);
        if (data.year)  kv.push(`Year: ${data.year}`);
        if (data.team)  kv.push(`Team: ${data.team}`);
        if (data.player)kv.push(`Player: ${data.player}`);
        if (data.grade && data.grade.company) kv.push(`Grade: ${data.grade.company} ${data.grade.grade||''}`);
        kvEl.innerHTML = kv.map(k=>`<span class="k">${k}</span>`).join('');

        const feats = [];
        const f = data.features || {};
        if (f.rookie) feats.push('Rookie');
        if (f.auto) feats.push('Auto');
        if (f.relic) feats.push('Relic');
        if (f.numbered) feats.push('Numbered');
        if (f.sp) feats.push('SP');
        if (f.ssp) feats.push('SSP');
        badgesEl.innerHTML = feats.map(k=>`<span class="b">${k}</span>`).join('');

        descEl.textContent = data.description || '';

        // Actions
        addBtn.onclick = () => {
          const cart = loadCart();
          const key = data.sku || (docRef && docRef.id);
          const existing = cart.find(i => i.sku === key);
          if (existing) existing.qty += 1;
          else cart.push({ sku:key, title:data.title, price:Number(data.price||0), img:primaryImg, qty:1 });
          saveCart(cart);
        };

        watchBtn.onclick = async () => {
          const user = requireLogin(); if(!user) return;
          const skuKey = data.sku || (docRef && docRef.id);
          const doc = {
            sku: skuKey,
            title: data.title || '',
            price: Number(data.price||0),
            img: primaryImg,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          try{
            await db.collection('users').doc(user.uid).collection('watchlist').doc(skuKey).set(doc);
            alert('Added to watchlist.');
          }catch(e){ console.error(e); alert('Failed to add to watchlist.'); }
        };

        offerBtn.onclick = () => {
          const user = requireLogin(); if(!user) return;
          offerItem.textContent = `${data.title || ''} • List: ${fmt(Number(data.price||0))}`;
          offerAmount.value = '';
          offerModal.style.display = 'flex';
        };

        offerCancel.onclick = () => { offerModal.style.display = 'none'; };

        offerSubmit.onclick = async () => {
          const user = requireLogin(); if(!user) return;
          const amt = parseFloat(offerAmount.value);
          if(!Number.isFinite(amt) || amt <= 0){ alert('Enter a valid amount.'); return; }
          const skuKey = data.sku || (docRef && docRef.id);
          const offer = {
            uid: user.uid,
            email: user.email || null,
            sku: skuKey,
            title: data.title || '',
            amount: amt,
            listPrice: Number(data.price||0),
            status: 'pending',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          try{
            await db.collection('offers').add(offer);
            alert('Offer submitted! We’ll review and respond.');
            offerModal.style.display = 'none';
          }catch(e){ console.error(e); alert('Failed to submit offer.'); }
        };

        setVisible(empty, false); setVisible(wrap, true);
        document.title = (data.title ? `${data.title} | Claw Mark Cards` : 'Product | Claw Mark Cards');

      } catch (err) {
        console.error('[Product] Fetch error', err);
        setVisible(wrap, false); setVisible(empty, true);
      }
    }

    fetchProduct();
  })();
  </script>
<script type="module" src="/js/offer-watch.js"></script>
</body>
</html>
